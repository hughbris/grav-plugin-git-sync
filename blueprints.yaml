name: Git Sync
type: plugin
slug: git-sync
version: 2.3.2
description: Allows to synchronize portions of Grav with Git Repositories (GitHub, BitBucket, GitLab)
icon: git
author:
  name: Trilby Media, LLC
  email: hello@trilby.media
  url: http://trilby.media
homepage: http://trilby.media
keywords: grav, plugin, git, sync, github, bitbucket, gitlab
issues: https://github.com/trilbymedia/grav-plugin-git-sync/issues
docs: https://github.com/trilbymedia/grav-plugin-git-sync
license: MIT

dependencies:
- { name: grav, version: '>=1.6.0' }
- { name: form, version: '>=2.16.3' }

form:
  validation: strict
  fields:
    Basic:
      type: section
      title: Basic Settings
      underline: true

    enabled:
      type: toggle
      label: Plugin Status
      highlight: 1
      default: 0
      options:
        1: Enabled
        0: Disabled
      validate:
        type: bool

    folders: # FIXME: allow or make sure sub-paths are supported
      type: select
      multiple: true
      label: Folders to Sync
      classes: fancy
      description: Removing folders after they have been synced may cause undesired results.
      default:
        - pages
      options:
        - pages
        - themes
        - plugins
        - config
        - data
      selectize:
        create: true
      validate:
        type: commalist

    Repo:
      type: section
      title: Git Repository Settings
      underline: true

    branch: # not sure if there will be a use for specifying a branch, probably will not be for the same purpose as the original plugin
      type: text
      default: master
      label: Local Branch
      placeholder: master

    # FIXME: needs restructuring, see yaml
    webhook:
      type: text
      label: Repository Web Hook URL
      placeholder: /_git-sync
      data-default@: '\Grav\Plugin\GitSyncPlugin::generateRandomWebhook'

    webhook_enabled:
      type: toggle
      label: Web Hook Secret
      highlight: 1
      default: 0
      options:
        1: Enabled
        0: Disabled
      description: With this setting enabled, only authorized webhook calls will be able to trigger a synchronization (recommended)

    webhook_secret:
      type: text
      label: Repository Web Hook Secret
      placeholder: Your Web Hook Secret
      data-default@: '\Grav\Plugin\GitSyncPlugin::generateWebhookSecret'
      description: You can either use this randomly generated string or enter your own secret. <br /> **Bitbucket** does not yet support Webhook Secrets.
      markdown: true

    Advanced:
      type: section
      title: Advanced Git Settings
      underline: true

    # probably wanna fix this or just grab git.name and git.email below
    git.author:
      type: select
      default: gituser
      label: Commits Author
      options:
        gituser: Use Git User Name
        gitsync: Use GitSync Committer Name
        gravuser: Use Grav User Name
        gravfull: Use Grav User Full Name

    # I'd like to make this just a default message and allow editors to set
    git.message:
      type: text
      default: (Grav GitSync) Automatic Commit
      label: Commit message
      placeholder: (Grav GitSync) Automatic Commit
      help: You can use {{pageTitle}} or {{pageRoute}} in your message as placeholders for the title or route of the page being saved

    git.name:
      type: text
      default: GitSync
      label: Committer Name
      placeholder: GitSync

    git.email:
      type: text
      default: git-sync@trilby.media
      label: Committer Email
      placeholder: git-sync@trilby.media

    git.bin:
      type: text
      default: git
      label: Git Binary Path
      help: If the default `git` command doesn't work on your machine or if you want to specify a custom path, do it in here
      placeholder: /usr/bin/git

    git.private_key:
      type: text
      label: Private SSH Key
      placeholder: ~/.ssh/id_rsa
      markdown: true
      description: >
        Point it to the secret (not the public) and make also sure you have strict permissions to the file. (`-rw-------`). <br />
        <br />
        Example: `private_key: /home/www-data/.ssh/id_rsa`<br />
        <br />
        **IMPORTANT**: SSH keys with passphrase are __NOT__ supported. To remove a passphrase, run the `ssh-keygen -p` command and when asked for the new passphrase leave blank and return.

    logging:
      type: toggle
      default: 0
      label: Log Git Commands
      help: Logs git commands. Useful to debug and troubleshoot git execution
      highlight: 0
      options:
        1: PLUGIN_ADMIN.YES
        0: PLUGIN_ADMIN.NO
      validate:
        type: bool
